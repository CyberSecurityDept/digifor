<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chain of Custody Report - ISO/IEC 27037</title>
    <style>
        body {
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #fff;
        }
        .header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 24px;
            margin: 0;
            font-weight: bold;
        }
        .header h2 {
            font-size: 18px;
            margin: 10px 0 0 0;
            font-weight: normal;
        }
        .section {
            margin-bottom: 25px;
        }
        .section h3 {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .info-table td {
            padding: 8px;
            border: 1px solid #000;
            vertical-align: top;
        }
        .info-table .label {
            background-color: #f0f0f0;
            font-weight: bold;
            width: 30%;
        }
        .custody-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .custody-table th,
        .custody-table td {
            padding: 8px;
            border: 1px solid #000;
            text-align: left;
            font-size: 12px;
        }
        .custody-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .signature-section {
            margin-top: 40px;
            page-break-inside: avoid;
        }
        .signature-box {
            border: 1px solid #000;
            padding: 10px;
            margin: 10px 0;
            min-height: 80px;
        }
        .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 10px;
            color: #666;
        }
        @media print {
            body { margin: 0; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>CHAIN OF CUSTODY REPORT</h1>
        <h2>ISO/IEC 27037:2012 Compliance</h2>
        <p><strong>Digital Forensics Analysis Platform</strong></p>
    </div>

    <div class="section">
        <h3>1. Evidence Information</h3>
        <table class="info-table">
            <tr>
                <td class="label">Evidence ID:</td>
                <td>{{ evidence_id }}</td>
            </tr>
            <tr>
                <td class="label">Evidence Number:</td>
                <td>{{ evidence_number }}</td>
            </tr>
            <tr>
                <td class="label">Evidence Title:</td>
                <td>{{ evidence_title }}</td>
            </tr>
            <tr>
                <td class="label">Case ID:</td>
                <td>{{ case_id }}</td>
            </tr>
            <tr>
                <td class="label">Evidence Type:</td>
                <td>{{ evidence_type }}</td>
            </tr>
            <tr>
                <td class="label">Collection Date:</td>
                <td>{{ collection_date }}</td>
            </tr>
            <tr>
                <td class="label">Collection Location:</td>
                <td>{{ collection_location }}</td>
            </tr>
            <tr>
                <td class="label">Collection Method:</td>
                <td>{{ collection_method }}</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <h3>2. Chain of Custody Events</h3>
        <table class="custody-table">
            <thead>
                <tr>
                    <th>Event #</th>
                    <th>Date/Time</th>
                    <th>Event Type</th>
                    <th>Person Handling</th>
                    <th>Location</th>
                    <th>Action Description</th>
                    <th>Tools Used</th>
                    <th>Witness</th>
                    <th>Verified</th>
                </tr>
            </thead>
            <tbody>
                {% for event in custody_events %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ event.event_date }}</td>
                    <td>{{ event.event_type }}</td>
                    <td>{{ event.person_name }}</td>
                    <td>{{ event.location }}</td>
                    <td>{{ event.action_description }}</td>
                    <td>{{ event.tools_used | join(', ') if event.tools_used else 'N/A' }}</td>
                    <td>{{ event.witness_name or 'N/A' }}</td>
                    <td>{{ 'Yes' if event.is_verified else 'No' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="section">
        <h3>3. Chain Integrity Verification</h3>
        <table class="info-table">
            <tr>
                <td class="label">Chain Integrity:</td>
                <td>{{ 'INTACT' if chain_integrity else 'BROKEN' }}</td>
            </tr>
            <tr>
                <td class="label">Total Events:</td>
                <td>{{ total_events }}</td>
            </tr>
            <tr>
                <td class="label">First Event:</td>
                <td>{{ first_event.event_date }} - {{ first_event.person_name }}</td>
            </tr>
            <tr>
                <td class="label">Last Event:</td>
                <td>{{ last_event.event_date }} - {{ last_event.person_name }}</td>
            </tr>
            <tr>
                <td class="label">Verification Date:</td>
                <td>{{ verification_date }}</td>
            </tr>
        </table>
    </div>

    <div class="section">
        <h3>4. Compliance Statement</h3>
        <p>This chain of custody report has been prepared in accordance with ISO/IEC 27037:2012 guidelines for the identification, collection, acquisition, and preservation of digital evidence. The chain of custody has been maintained throughout the investigation process, ensuring the integrity and admissibility of the evidence in legal proceedings.</p>
        
        <p><strong>Key Compliance Elements:</strong></p>
        <ul>
            <li>Evidence identification and documentation</li>
            <li>Secure collection and acquisition procedures</li>
            <li>Proper handling and storage protocols</li>
            <li>Immutable custody log maintenance</li>
            <li>Verification and authentication processes</li>
        </ul>
    </div>

    <div class="signature-section">
        <h3>5. Authorized Signatures</h3>
        
        <div class="signature-box">
            <p><strong>Investigator:</strong> _________________________</p>
            <p><strong>Name:</strong> {{ investigator_name }}</p>
            <p><strong>Title:</strong> {{ investigator_title }}</p>
            <p><strong>Date:</strong> _________________________</p>
            <p><strong>Signature:</strong> _________________________</p>
        </div>

        <div class="signature-box">
            <p><strong>Supervisor:</strong> _________________________</p>
            <p><strong>Name:</strong> {{ supervisor_name }}</p>
            <p><strong>Title:</strong> {{ supervisor_title }}</p>
            <p><strong>Date:</strong> _________________________</p>
            <p><strong>Signature:</strong> _________________________</p>
        </div>
    </div>

    <div class="footer">
        <p>Generated by Digital Forensics Analysis Platform</p>
        <p>Report ID: {{ report_id }} | Generated: {{ generated_date }}</p>
        <p>This document is confidential and intended for authorized personnel only.</p>
    </div>
</body>
</html>
